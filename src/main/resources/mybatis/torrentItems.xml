<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jasonfunderburker.couchpotato.mapper.TorrentItemMapper">

    <resultMap id="torrentItemMap" type="TorrentItem">
        <id property="id" column="torrentId"/>
        <result property="name" column="torrentName"/>
        <result property="link" column="torrentLink"/>
        <result property="status" column="statusId" typeHandler="TorrentStatusEnumTypeHandler"/>
        <result property="type" column="typeId" typeHandler="TorrentTypeEnumTypeHandler"/>
        <result property="errorText" column="errorText"/>
        <association property="state" javaType="TorrentState">
            <result property="state" column="torrentState"/>
        </association>
    </resultMap>

    <select id="findById" resultMap="torrentItemMap">
        select
          tl.id torrentId,
          tl.name torrentName,
          tl.link torrentLink,
          tl.status_id statusId,
          tl.error_text errorText,
          tl.state torrentState,
          tt.id typeId,
          tt.name typeName
        from torrents_list tl, torrents_types tt
        where tl.type_id = tt.id
        and tl.id = #{id}
    </select>

    <select id="getItemsList" resultMap="torrentItemMap">
        select
          tl.id torrentId,
          tl.name torrentName,
          tl.link torrentLink,
          tl.status_id statusId,
          tl.error_text errorText,
          tl.state torrentState,
          tt.id typeId,
          tt.name typeName
        from torrents_list tl, torrents_types tt
        where tl.type_id = tt.id
    </select>

    <update id="updateItem" parameterType="TorrentItem">
        update torrents_list
        set name = #{name},
            link = #{link},
            status_id = #{status, typeHandler=TorrentStatusEnumTypeHandler},
            state = #{state.state},
            error_text = #{errorText}
         where id = #{id}
    </update>

    <insert id="addItemToList" parameterType="TorrentItem">
        insert into torrents_list
        (name, link, status_id, type_id, state)
        values
        (#{name}, #{link}, #{status, typeHandler=TorrentStatusEnumTypeHandler}, #{type, typeHandler=TorrentTypeEnumTypeHandler}, #{state.state})
    </insert>

    <delete id="deleteItemFromList">
        delete from torrents_list
        where id = #{id}
    </delete>
</mapper>